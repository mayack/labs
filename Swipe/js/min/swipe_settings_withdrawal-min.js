function updateWithdrawalMethodRows(){$(".bank-account-row").unbind("mouseleave").mouseleave(function(){$(this).find(".delete-bank-account").hide()}),$(".bank-account-row").unbind("mouseover").mouseover(function(){$(this).find(".delete-bank-account").show()}),$(".delete-bank-account").unbind("click").click(function(a){deleteBankAccountID=$(this).parent().parent().data("id"),$("#modal-delete-bank-account").bPopup()})}function deleteBankAccount(){formdata=new FormData,formdata&&(formdata.append("custom_action","delete_bank_account"),formdata.append("id",deleteBankAccountID),formdata.append("csrfmiddlewaretoken",$('input[name="csrfmiddlewaretoken"]').val())),$.ajax({url:"",type:"POST",data:formdata,processData:!1,contentType:!1,dataType:"JSON",success:function(a){try{-1==a.status&&(window.location=loginPageLink)}catch(e){}$("#bank-account-placeholder").show(),$(".bank-account-row").remove(),$("#add-bank-account-button").show(),$("#modal-delete-bank-account").bPopup().close()},error:function(a,e,n){}})}function truncString(a){var e=14,n=7;a.length>21&&(a=a.substring(0,e)+"&#8230;"+a.substring(a.length-n,a.length));var a=a.replace(" ","_");return a}function checkChanges(){var a=!1,e=1;defaultTransferRateType!=$("input[name='radio-transfer-group']").val()&&(a=!0),1==$("input[name='radio-transfer-group']").val()&&defaultTransferRateDays!=$("#transfer-days").val()&&(a=!0),($("#responsible_person_first_name").val()!=defaultPersonFirstName||$("#responsible_person_last_name").val()!=defaultPersonLastName)&&(a=!0),1==$("input[name='radio-transfer-group']").val()&&0==$("#transfer-days").val().length&&(a=!1),a?$("#submit-button").prop("disabled",!1):$("#submit-button").prop("disabled",!0)}function updateFileChange(){$("#input-document").unbind("change").on("change",function(a){console.log("change");var e=a.target.files[0];if(!e)return!1;if(e.size>maxFileSize)return $("#modal-file-size-error").bPopup(),!1;if(e.type.match("image.*")||"application/pdf"===e.type){fileData=e,console.log(fileData),fileName=truncString(fileData.name);var n=new FileReader;n.onload=function(a){return function(e){if($("#upload-button").html("<span id='test' class='icon-spin5 animate-spin' style='line-height:12px'></span>&nbsp;Uploading&#8230;"),"application/pdf"===a.type)formdata=new FormData,formdata&&(formdata.append("data",fileData),formdata.append("csrfmiddlewaretoken",$('input[name="csrfmiddlewaretoken"]').val())),$.ajax({url:"",type:"POST",data:formdata,processData:!1,contentType:!1,dataType:"JSON",success:function(a){try{-1==a.status&&(window.location=loginPageLink)}catch(e){}$("#upload-button").hide(),$("#upload-document-view").show(),$("#file-name").html(fileName),$("#upload-info-text").hide(),$("#delete-document").show()},error:function(a,e,n){}});else{var n=new Image;n.src=e.target.result,n.onload=function(){var a=this.width,e=this.height;formdata=new FormData,formdata&&(formdata.append("custom_action","passport_scan"),formdata.append("passport_scan",fileData),formdata.append("csrfmiddlewaretoken",$('input[name="csrfmiddlewaretoken"]').val())),$.ajax({url:"",type:"POST",data:formdata,processData:!1,contentType:!1,dataType:"JSON",success:function(a){try{-1==a.status&&(window.location=loginPageLink)}catch(e){}1==a.status&&($("#upload-button").hide(),$("#upload-document-view").show(),$("#file-name").html(fileName),$("#upload-info-text").hide(),$("#delete-document").show())},error:function(a,e,n){}})}}}}(e)}n.readAsDataURL(e)}),$("#input-new-document").unbind("change").on("change",function(a){console.log("change2");var e=a.target.files[0];if(!e)return!1;if(e.size>maxFileSize)return $("#modal-file-size-error").bPopup(),!1;if(e.type.match("image.*")||"application/pdf"===e.type){newFileData=e,console.log(newFileData),fileName=truncString(newFileData.name);var n=new FileReader;n.onload=function(a){return function(a){$("#new-upload-button").hide(),$("#new-upload-document-view").show(),$("#new-file-name").html(fileName)}}(e)}n.readAsDataURL(e)})}function postPersonChange(){var a=1,e;return 0==$("#change-person-first-name").val().length?($("#change-person-first-name").addClass("warning-input"),a=0):$("#change-person-first-name").removeClass("warning-input"),0==$("#change-person-last-name").val().length?($("#change-person-last-name").addClass("warning-input"),a=0):$("#change-person-last-name").removeClass("warning-input"),newFileData?$("#new-upload-button").removeClass("warning-input"):($("#new-upload-button").addClass("warning-input"),a=0),0==a?!1:(formdata=new FormData,formdata&&(formdata.append("custom_action","resubmit_personal_details"),formdata.append("passport_scan",newFileData),formdata.append("responsible_person_first_name",$("#change-person-first-name").val()),formdata.append("responsible_person_last_name",$("#change-person-last-name").val()),formdata.append("csrfmiddlewaretoken",$('input[name="csrfmiddlewaretoken"]').val())),$.ajax({url:".",contentType:!1,processData:!1,cache:!1,type:"POST",data:formdata,dataType:"JSON",success:function(a){try{-1==a.status&&(window.location=loginPageLink)}catch(e){}1==a.status&&window.location.reload(!0)},error:function(a,e,n){}}),!1)}function postMainFormData(){var a=!0;return 0==$("#responsible_person_first_name").val().length?($("#responsible_person_first_name").addClass("warning-input"),a=!1):$("#responsible_person_first_name").removeClass("warning-input"),0==$("#responsible_person_last_name").val().length?($("#responsible_person_last_name").addClass("warning-input"),a=!1):$("#responsible_person_last_name").removeClass("warning-input"),fileData||($("#upload-button").addClass("warning-input"),a=!1),a?(formdata=new FormData,formdata&&(formdata.append("responsible_person_first_name",$("#responsible_person_first_name").val()),formdata.append("responsible_person_last_name",$("#responsible_person_last_name").val()),formdata.append("automatic_transfers",$("#automatic_transfers").val()),formdata.append("csrfmiddlewaretoken",$('input[name="csrfmiddlewaretoken"]').val())),$.ajax({url:"",type:"POST",data:formdata,processData:!1,contentType:!1,dataType:"JSON",success:function(a){try{-1==a.status&&(window.location=loginPageLink)}catch(e){}window.location.reload(!0)},error:function(a,e,n){}}),!1):!1}function postBankAccount(){if(postButtonDisabled)return!1;var a=1;if(0==$("input[name='iban']").val().length?($("input[name='iban']").addClass("warning-input"),$("#modal-add-bank-error-text").html("Please fill your bank iban"),a=0):IBAN.isValid($("input[name='iban']").val())?($("input[name='iban']").removeClass("warning-input"),$("#modal-add-bank-error-text").html("")):($("input[name='iban']").addClass("warning-input"),$("#modal-add-bank-error-text").html("Specified bank account is not valid."),a=0),0==a)return!1;var e=$("#modal-add-bank-button").html();return $("#modal-add-bank-button").html("<span class='icon-spin5 animate-spin' style='line-height:14px'></span>"),postButtonDisabled=!0,$.post("",$("#modal-add-bank-form").serializeArray()).done(function(a){a=JSON.parse(a),$("#bank-account-placeholder").hide(),$("#bank-account-view").show(),$("#add-bank-account-button").hide(),$("#modal-add-bank").bPopup().close(),bankAccountTemplate="<div class='input-dummy-bg move-left margin-top-10 margin-bottom-10 bank-account-row' data-id='"+a.id+"'><input id='radio-1' class='radio-custom' name='radio-group' type='radio' checked><label for='radio-1' class='radio-custom-label'></label><span class='text-medium'>&nbsp;&nbsp;&nbsp;"+$("input[name='iban']").val()+"<!-- / --> </span> <!-- Swedbank --><div class='delete-withdrawal-method'><div class='margin-reset icon-cross text-gray-60 align-center delete-bank-account' style='display:none'></div></div><span class='move-right bank-button align-center text-medium text-12 margin-bottom-5' onclick=\"$('#modal-verify-bank').bPopup()\">"+strVerify+"</span></div>",console.log(bankAccountTemplate),$("#bank-account-header").after(bankAccountTemplate),updateWithdrawalMethodRows(),$("#modal-add-bank-button").html(e),postButtonDisabled=!1}).fail(function(){}),!1}var newFileData=!1,postButtonDisabled=!1,deleteBankAccountID=!1,defaultTransferRateType,defaultTransferRateDays,defaultPersonFirstName,defaultPersonLastName;$(window).load(function(){defaultTransferRateType=$("input[name='radio-transfer-group']").val(),defaultTransferRateDays=$("#transfer-days").val(),defaultPersonFirstName=$("#responsible_person_first_name").val(),defaultPersonLastName=$("#responsible_person_last_name").val(),$("#file-name").html(truncString($("#file-name").html()))}),$(function(){$("#responsible_person_first_name, #responsible_person_last_name").keypress(function(){$(this).removeClass("warning-input"),checkChanges()}),$("#responsible_person_first_name, #responsible_person_last_name").keyup(function(){checkChanges()}),$("#upload-button").click(function(a){a.preventDefault(),$("#input-document").trigger("click")}),$("#new-upload-button").click(function(a){a.preventDefault(),$("#input-new-document").trigger("click")}),$("input[name='radio-transfer-group']").on("click",function(a){1==$(this).val()?$("#transfer-days").prop("disabled",!1):$("#transfer-days").prop("disabled",!0)}),$("#modal-delete-bank-account-submit").unbind("click").click(function(a){deleteBankAccount()}),$("#delete-document").unbind("click").click(function(a){fileData=!1,formdata=new FormData,formdata&&(formdata.append("custom_action","passport_scan_delete"),formdata.append("csrfmiddlewaretoken",$('input[name="csrfmiddlewaretoken"]').val())),$.ajax({url:"",type:"POST",data:formdata,processData:!1,contentType:!1,dataType:"JSON",success:function(a){try{-1==a.status&&(window.location=loginPageLink)}catch(e){}$("#upload-button").html("<span id='test' class='icon-upload'></span>&nbsp;Upload Passport Scan"),$("#upload-button").show(),$("#upload-document-view").hide(),$("#upload-info-text").show(),$("#pending-document").hide(),$("#delete-document").hide()},error:function(a,e,n){}})}),updateWithdrawalMethodRows(),updateFileChange()});